-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.comisiones (
  id integer NOT NULL DEFAULT nextval('comisiones_id_seq'::regclass),
  monto_min numeric NOT NULL,
  monto_max numeric NOT NULL,
  comision numeric NOT NULL,
  CONSTRAINT comisiones_pkey PRIMARY KEY (id)
);
CREATE TABLE public.conciliacion_diaria (
  id integer NOT NULL DEFAULT nextval('conciliacion_diaria_id_seq'::regclass),
  fecha date UNIQUE,
  total_confirmado numeric DEFAULT 0,
  total_banco numeric DEFAULT 0,
  diferencia numeric DEFAULT (total_confirmado - total_banco),
  observaciones text,
  CONSTRAINT conciliacion_diaria_pkey PRIMARY KEY (id)
);
CREATE TABLE public.config (
  id integer NOT NULL DEFAULT nextval('config_id_seq'::regclass),
  tasa_cambio numeric DEFAULT 0,
  fecha_actualizacion timestamp without time zone DEFAULT now(),
  CONSTRAINT config_pkey PRIMARY KEY (id)
);
CREATE TABLE public.logs_operacion (
  id integer NOT NULL DEFAULT nextval('logs_operacion_id_seq'::regclass),
  transaccion_id integer,
  fecha timestamp without time zone DEFAULT now(),
  accion character varying,
  usuario_admin character varying,
  comentario text,
  CONSTRAINT logs_operacion_pkey PRIMARY KEY (id),
  CONSTRAINT logs_operacion_transaccion_id_fkey FOREIGN KEY (transaccion_id) REFERENCES public.transacciones(id)
);
CREATE TABLE public.transacciones (
  id integer NOT NULL DEFAULT nextval('transacciones_id_seq'::regclass),
  fecha_creacion timestamp without time zone DEFAULT now(),
  monto_usd numeric NOT NULL CHECK (monto_usd >= 50::numeric),
  comision_usd numeric NOT NULL,
  total_usd numeric DEFAULT (monto_usd + comision_usd),
  tasa_cambio numeric DEFAULT 0,
  monto_cup numeric DEFAULT (monto_usd * tasa_cambio),
  estado character varying DEFAULT 'pendiente'::character varying,
  red_flags boolean DEFAULT false,
  nota_admin text,
  comprobante_url text,
  remitente_nombre character varying NOT NULL,
  remitente_whatsapp character varying NOT NULL,
  remitente_email character varying,
  beneficiario_nombre character varying NOT NULL,
  beneficiario_provincia character varying NOT NULL,
  beneficiario_whatsapp character varying,
  CONSTRAINT transacciones_pkey PRIMARY KEY (id)
);